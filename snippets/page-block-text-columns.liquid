<div class="index-section">
  <div class="page-width text-{{ block.settings.align_text }}">
    {% if block.settings.title != blank %}
      <div class="section-header">
        <h2>{{ block.settings.title }}</h2>
      </div>
    {% endif %}

    {% assign text_column_count = 0 %}
    {% assign column_flags = '' %}

    {% for i in (1..3) %}
      {% assign enable_key = 'enable_image_' | append: i %}
      {% assign title_key = 'title_' | append: i %}
      {% assign text_key = 'text_' | append: i %}

      {% assign enable_val = block.settings[enable_key] %}
      {% assign title_val = block.settings[title_key] %}
      {% assign text_val = block.settings[text_key] %}

      {% if enable_val or title_val != blank or text_val != blank %}
        {% assign text_column_count = text_column_count | plus: 1 %}
        {% assign column_flags = column_flags | append: '1' %}
      {% else %}
        {% assign column_flags = column_flags | append: '0' %}
      {% endif %}
    {% endfor %}

    {% case text_column_count %}
      {% when 1 %}
        {% assign grid_item_width = '' %}
      {% when 2 %}
        {% assign grid_item_width = 'medium-up--one-half' %}
      {% when 3 %}
        {% assign grid_item_width = 'medium-up--one-third' %}
    {% endcase %}

    <div class="grid grid--flush-bottom">
      {% for i in (1..3) %}
        {% assign show_column = column_flags | slice: i-1, 1 %}
        {% if show_column == '1' %}

          {% assign enable_key = 'enable_image_' | append: i %}
          {% assign title_key = 'title_' | append: i %}
          {% assign text_key = 'text_' | append: i %}
          {% assign image_key = 'image_' | append: i %}
          {% assign svg_key = 'svg_icon_' | append: i %}
          {% assign width_key = 'image_width_' | append: i %}
          {% assign link_key = 'button_link_' | append: i %}
          {% assign label_key = 'button_label_' | append: i %}

          {% assign enable_image = block.settings[enable_key] %}
          {% assign title = block.settings[title_key] %}
          {% assign text = block.settings[text_key] %}
          {% assign image = block.settings[image_key] %}
          {% assign svg_icon = block.settings[svg_key] %}
          {% assign image_width = block.settings[width_key] %}
          {% assign button_link = block.settings[link_key] %}
          {% assign button_label = block.settings[label_key] %}

          <div class="grid__item {{ grid_item_width }}" data-aos="row-of-3">
            {% if enable_image %}
              <div style="{% if block.settings.align_text == 'center' %}margin: 0 auto;{% endif %} max-width: {{ image_width }}px;">
                {% if button_link != blank %}
                  <a href="{{ button_link }}">
                {% endif %}

                {% if svg_icon %}
                  <div class="custom-icon">
                    {{ svg_icon | raw }}
                  </div>
                {% elsif image != blank %}
                  <div class="image-wrap text-spacing" style="height: 0; padding-bottom: {{ 100 | divided_by: image.aspect_ratio }}%;">
                    {% assign img_url = image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}
                    <img class="lazyload"
                      data-src="{{ img_url }}"
                      data-widths="[180, 360, 540, 720, 900, 1080]"
                      data-aspectratio="{{ image.aspect_ratio }}"
                      data-sizes="auto"
                      alt="{{ image.alt }}">
                  </div>
                {% else %}
                  <div class="image-wrap text-spacing">
                    {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                  </div>
                {% endif %}

                {% if button_link != blank %}
                  </a>
                {% endif %}
              </div>
            {% endif %}

            {% if title != blank %}
              <p class="h3">{{ title }}</p>
            {% endif %}
            {% if text != blank %}
              <div class="rte-setting text-spacing">{{ text }}</div>
            {% endif %}
            {% if button_label != blank %}
              <a href="{{ button_link }}" class="btn btn--secondary btn--small">
                {{ button_label }}
              </a>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>
